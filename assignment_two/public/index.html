<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Collection Agent - Configuration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">
                    <i class="fas fa-robot text-blue-600 mr-2"></i>
                    Debt Collection Testing Platform
                </h1>
                <div class="flex space-x-6">
                    <a href="/" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-1">
                        <i class="fas fa-cog mr-1"></i> Main Agent
                    </a>
                    <a href="/test-agents" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-users mr-1"></i> Test Agents
                    </a>
                    <a href="/simulate" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-comments mr-1"></i> Simulate
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-6 py-8">
        <!-- Header Section -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Main Debt Collection Agent</h2>
            <p class="text-gray-600">Configure your primary debt collection agent's prompt and behavior. This agent will
                be tested against various customer personalities.</p>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="hidden mb-6 p-4 rounded-lg"></div>

        <!-- Configuration Form -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
            <form id="agentForm">
                <!-- Agent Name -->
                <div class="mb-6">
                    <label for="agentName" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user-tie text-blue-600 mr-1"></i>
                        Agent Name
                    </label>
                    <input type="text" id="agentName" name="name"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"
                        placeholder="e.g., Sarah - Debt Collection Agent" required>
                </div>

                <!-- Agent Prompt -->
                <div class="mb-6">
                    <label for="agentPrompt" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-file-alt text-blue-600 mr-1"></i>
                        Agent Instructions & Prompt
                    </label>
                    <textarea id="agentPrompt" name="prompt" rows="16"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors font-mono text-sm"
                        placeholder="Enter the complete instructions for your debt collection agent..."
                        required></textarea>
                    <p class="text-sm text-gray-500 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        This prompt will define how your agent behaves during debt collection calls. Include tone,
                        approach, conversation flow, and specific guidelines.
                    </p>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center">
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-save mr-1"></i>
                        Changes are saved automatically
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" id="resetBtn"
                            class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-undo mr-1"></i>
                            Reset to Default
                        </button>
                        <button type="submit"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-save mr-1"></i>
                            Save Configuration
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Quick Actions -->
        <div class="mt-8 grid md:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">
                    <i class="fas fa-users text-green-600 mr-2"></i>
                    Manage Test Agents
                </h3>
                <p class="text-gray-600 mb-4">Create and configure loan defaulter personalities to test your agent
                    against various customer scenarios.</p>
                <a href="/test-agents"
                    class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-arrow-right mr-1"></i>
                    Manage Test Agents
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">
                    <i class="fas fa-play-circle text-purple-600 mr-2"></i>
                    Start Simulation
                </h3>
                <p class="text-gray-600 mb-4">Run automated conversations between your debt collection agent and test
                    customer personalities.</p>
                <a href="/simulate"
                    class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                    <i class="fas fa-arrow-right mr-1"></i>
                    Start Simulation
                </a>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="mt-8 bg-blue-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-blue-900 mb-3">
                <i class="fas fa-lightbulb text-blue-600 mr-2"></i>
                Prompt Writing Tips
            </h3>
            <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-800">
                <div>
                    <p class="mb-2"><strong>Be Specific:</strong> Include exact tone, approach, and conversation flow
                        you want</p>
                    <p class="mb-2"><strong>Set Context:</strong> Mention specific debt amount, days overdue, company
                        name</p>
                </div>
                <div>
                    <p class="mb-2"><strong>Handle Reactions:</strong> Specify how to handle denial, anger, cooperation
                    </p>
                    <p><strong>End Goals:</strong> Define clear objectives like payment commitment or payment plan</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentAgent = null;

        // Load current agent configuration
        async function loadAgent() {
            try {
                const response = await fetch('/api/main-agent');
                const agent = await response.json();

                if (agent) {
                    currentAgent = agent;
                    document.getElementById('agentName').value = agent.name || '';
                    document.getElementById('agentPrompt').value = agent.prompt || '';
                }
            } catch (error) {
                showStatus('Error loading agent configuration', 'error');
            }
        }

        // Save agent configuration
        async function saveAgent(data) {
            try {
                const response = await fetch('/api/main-agent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    showStatus('Agent configuration saved successfully!', 'success');
                    currentAgent = data;
                } else {
                    showStatus('Error saving configuration', 'error');
                }
            } catch (error) {
                showStatus('Error saving configuration', 'error');
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `mb-6 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200'}`;
            statusEl.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>${message}`;
            statusEl.classList.remove('hidden');

            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 5000);
        }

        // Reset to default configuration
        function resetToDefault() {
            const defaultPrompt = `You are Sarah, a professional and polite debt collection representative from SecureBank. Your role is to contact customers about overdue credit card payments in a respectful, human-like manner.

Key guidelines:
1. TONE: Be polite, professional, but persistent. Sound like a real human.
2. PURPOSE: You're calling about an overdue credit card payment.
3. APPROACH: Start with verification, explain the situation, offer solutions.
4. RESPONSES: Handle various customer reactions (denial, anger, payment promises).
5. CLOSURE: Always end with clear next steps.

CONVERSATION FLOW:
- Greet politely and identify yourself
- Verify you're speaking to the right person
- Explain the overdue payment situation  
- Listen to their response and offer solutions
- Attempt to secure a payment commitment
- End with clear follow-up actions

Remember: You're calling about a $2,847.32 overdue payment that's 45 days past due. Be understanding but firm about the need for payment resolution.`;

            document.getElementById('agentName').value = 'Sarah - Debt Collection Agent';
            document.getElementById('agentPrompt').value = defaultPrompt;
        }

        // Event listeners
        document.getElementById('agentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            await saveAgent(data);
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset to default configuration? This will overwrite your current prompt.')) {
                resetToDefault();
            }
        });

        // Load agent on page load
        loadAgent();
    </script>
</body>

</html>